YUI.add("moodle-atto_studietube-button",function(n,e){var i="atto_studietube",l={INPUTHEIGHT:"atto_studietube_heightentry",INPUTSUBMIT:"atto_studietube_submit",INPUTSIZE:"atto_studietube_size",INPUTFULLSIZE:"atto_studietube_fullsize",INPUTWIDTH:"atto_studietube_widthentry"},d=/\d+%/,t=/stdsts_holder(?: stdconfig-(?<id>[A-Za-z0-9]+)-(?<width>[0-9]+)-(?<height>[0-9]+)-(?<fullsize>([0-1]+)))/is,s=560,o=314,a=0,u='<form class="atto_form"><div class="mb-1"><label class="" for="{{elementid}}_{{CSS.INPUTSIZE}}">{{get_string "size" component}}</label><div id="{{elementid}}_{{CSS.INPUTSIZE}}" class="form-inline {{CSS.INPUTSIZE}}"><label class="accesshide" for="{{elementid}}_{{CSS.INPUTWIDTH}}">{{get_string "width" component}}</label><input type="text" class="form-control mr-1 input-mini {{CSS.INPUTWIDTH}}" id="{{elementid}}_{{CSS.INPUTWIDTH}}" size="4"/> x<label class="accesshide" for="{{elementid}}_{{CSS.INPUTHEIGHT}}">{{get_string "height" component}}</label><input type="text" class="form-control ml-1 input-mini {{CSS.INPUTHEIGHT}}" id="{{elementid}}_{{CSS.INPUTHEIGHT}}" size="4"/><div class="form-check ml-2"><input type="checkbox" class="form-check-input {{CSS.INPUTFULLSIZE}}" id="{{elementid}}_{{CSS.INPUTFULLSIZE}}" {{#if fullsize}}checked{{/if}}/><label class="form-check-label" for="{{elementid}}_{{CSS.INPUTFULLSIZE}}">{{get_string "fullsize" component}}</label></div></div></div><button class="btn btn-secondary {{CSS.INPUTSUBMIT}}" type="submit">{{get_string "saveimage" component}}</button></div></form>',h='<div class="stdsts_holder stdconfig-{{id}}-{{width}}-{{height}}-{{fullsize}} {{#if fullsize}}stdsts_fullsize{{/if}}" {{#unless fullsize}}style="width:{{#if width}}{{width}}{{/if}}px;height:{{#if height}}{{height}}{{/if}}px;"{{/unless}} contenteditable="false" data-studietube-id="{{id}}" data-studietube-config="{{width}}:{{height}}:{{fullsize}}"><iframe src="//www.skoletube.dk/e/{{id}}/0" {{#unless fullsize}}style="width:{{#if width}}{{width}}{{/if}}px;height:{{#if height}}{{height}}{{/if}}px;"{{/unless}} allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>Please activate Studietube filter</div>';n.namespace("M.atto_studietube").Button=n.Base.create("button",n.M.editor_atto.EditorPlugin,[],{_currentSelection:null,initializer:function(){var t=this;window.addEventListener("message",function(e){t._handleMedia(e,t)},!1),this.addButton({icon:"studietube",iconComponent:i,callback:this._displayDialogue}),this.editor.delegate("click",this._handleClick,".stdsts_holder",this),this.editor.delegate("click",this._displaySizeDiag,".stdsts_holder",this),setTimeout(this.changeToTags(),500)},changeToTags:function(){this.replaceTags(this.editor.all(".stdsts_holder"))},replaceTags:function(e){e.each(function(e){var t=this._getstsconfig(e),i=n.Handlebars.compile(h);newiframe=i({width:t.width,height:t.height,fullsize:Number(t.fullsize),id:t.id}),e.replace(newiframe)},this)},_getstsconfig:function(e){if(found=e.getAttribute("class").match(t),"undefined"!=typeof found.groups)return("undefined"==typeof found.groups.width||parseInt(found.groups.width)<=0)&&(found.groups.width=s),("undefined"==typeof found.groups.height||parseInt(found.groups.height)<=0)&&(found.groups.height=o),("undefined"==typeof found.groups.fullsize||Number(found.groups.fullsize)<=0)&&(found.groups.fullsize=a),found.groups},_displayDialogue:function(){var e,t;this._dialogue=null,e=this.getDialogue({headerContent:M.util.get_string("studietube",i),width:"600px",height:"500px",focusAfterHide:!0}),(t=n.Node.create("<iframe></iframe>")).setStyles({height:"400px",border:"none",width:"100%"}),t.setAttribute("src","//www.studietube.dk/app/bluebird/1?passtype=complete&notok=true&noselector=true&idcaller="+this.editor._yuid),e.set("bodyContent",t).show()},_displaySizeDiag:function(e){this._dialogue=null,this._currentSelection=e.target,!1!==this._currentSelection&&(this._rawImageDimensions=null,this.getDialogue({headerContent:M.util.get_string("stsize",i),width:"auto",focusAfterHide:null}).set("bodyContent",this._getDialogueContent()).show())},_getDialogueContent:function(){var e=n.Handlebars.compile(u),e=n.Node.create(e({elementid:this.get("host").get("elementid"),CSS:l,component:i}));return this._form=e,this._applyProperties(this._form),this._form.one("."+l.INPUTSUBMIT).on("click",this._changesize,this),this._form.one("."+l.INPUTFULLSIZE).on("change",function(e){this._lockfullsize(e.target)},this),e},_applyProperties:function(e){var t=this._getstsconfig(this._currentSelection);t.width&&e.one("."+l.INPUTWIDTH).set("value",t.width),t.height&&e.one("."+l.INPUTHEIGHT).set("value",t.height),t.fullsize&&e.one("."+l.INPUTFULLSIZE).set("checked",!0),this._lockfullsize(e.one("."+l.INPUTFULLSIZE))},_changesize:function(e){var t=this._form,i=t.one("."+l.INPUTWIDTH).get("value"),s=t.one("."+l.INPUTHEIGHT).get("value"),o=t.one("."+l.INPUTFULLSIZE).get("checked");this.get("host");e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),i.match(d)||!isNaN(parseInt(i,10))?s.match(d)||!isNaN(parseInt(s,10))?(stsobj=this._currentSelection.getDOMNode(),e=n.Handlebars.compile(h),newiframe=e({width:i,height:s,fullsize:Number(o),id:stsobj.getAttribute("data-studietube-id")}),this._currentSelection.replace(newiframe),this.markUpdated()):t.one("."+l.INPUTHEIGHT).focus():t.one("."+l.INPUTWIDTH).focus()},_lockfullsize:function(e){var t=this._form;e.get("checked")?(t.one("."+l.INPUTWIDTH).set("disabled",!0),t.one("."+l.INPUTHEIGHT).set("disabled",!0)):(t.one("."+l.INPUTWIDTH).set("disabled",!1),t.one("."+l.INPUTHEIGHT).set("disabled",!1))},_handleClick:function(e){var e=e.target,e=this.get("host").getSelectionFromNode(e);this.get("host").getSelection()!==e&&this.get("host").setSelection(e)},_handleMedia:function(e,t){this.getDialogue({focusAfterHide:null}).hide(),
"https://www.studietube.dk"!==e.origin&&"http://www.studietube.dk"!==e.origin&&"http://www.skoletube.dk"!==e.origin&&"https://www.skoletube.dk"!==e.origin||"undefined"!=typeof(e=JSON.parse(e.data)).idcaller&&e.idcaller.includes(t.editor._yuid)&&("undefined"==typeof e.extra&&(e.extra={}),("undefined"==typeof e.extra.width||parseInt(e.extra.width)<=0)&&(e.extra.width=s),("undefined"==typeof e.extra.height||parseInt(e.extra.height)<=0)&&(e.extra.height=o),t=n.Handlebars.compile(h),html=t({width:e.extra.width,height:e.extra.height,fullsize:a,id:e.vkey}),selectednode=this.get("host").insertContentAtFocusPoint(html),this.get("host").setSelection(this.get("host").getSelectionFromNode(selectednode)),this.markUpdated(),this._displaySizeDiag({target:selectednode}))}},{ATTRS:{full:{value:!1}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});